# aTES system design

## Services info
### task-service
- Отвечает за бизнес логику связанную с тасктрекером
- Хранит список задач
- Хранит пользователей с минимальным набором данных: ИД, роль и, возможно, необходимую информацию для отображения на FE.
- Предоствляет REST API по управлению задачами и пользователями.
- Генерирует события связанные с изменением состояния задачи: создана, сделана, назначена на кого-то.
### accounting-service
- Отвечает за бизнес логику связанную с расчетом кто сколько денег заработал
- Хранит баланс пользователя и лог изменения баланса с причиной и с ссылкой на таск_ид
- Производит операции ежедневных выплат обнуля баланс пользователя
- Предоствляет REST API по управлению расценками и правилами за задачу, получению информации о балансе пользователей.
- Генерирует события связанные с изменением баланса пользователя
### analytics-service
- Слушает события от сервисов, выполняет операции над входящими событиями, что бы собрать нужную статистику.
- Предоставляет REST API для получения стат данных.

## Communication between services
Взаимодействие между сервисами асинхронное, посредством брокера сообщений.
### События task-service
- OnTaskChange: { task_id:uuid, assigned:uuid, status:enum }. task.status: todo/done.
### События accounting-service
- OnBalanceChange: {user_id:uuid, amount:number, reason:enum, extra: { task_id:uuid } }. reason: task_assigned/task_done/payout.

## Open questions
- Неуверен в правильности разбивки на сервисиы, так как accounting-service будет знать о домене тасктрекера. А analytics-service будет знать и о деньгах и о тасках.
- Возможно расчет вознаграждения отправить в task-service и создавать событие уже сразу с "ценой"?
- Смущает analytics-service. С одной стороны нужна система которая будет трансформировать данные для использования в DW. Но, возможно, ее необходимо будет исправлять всякий раз, когда меняется accounting-service или task-service.
- Проблемы с сетью не смущают: можно использовать outbox паттерн, что бы добиться консистентности данных в БД и брокере. 
- Сервисы независимы и смогут работать один без другого, не блокируя бизнеспроцессы за которые отвечают. 